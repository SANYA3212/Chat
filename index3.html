<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>S/E Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="js/markdown-it.min.js"></script>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" id="highlight-light-theme" href="js/highlightjs/default-light.min.css" media="all" disabled>
  <link rel="stylesheet" id="highlight-dark-theme" href="js/highlightjs/default-dark.min.css" media="all" disabled>
  
  <!-- MathJax Configuration -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  </script>
  <!-- Local MathJax files for offline use -->
  <script id="MathJax-script" async src="mathjax-offline/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å (—Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤) -->
  <div class="sidebar" id="sidebar">
    <div class="header">
      <img src="icon/logo.png" alt="Logo" class="logo">
      <h1 id="headerTitle">S/E Chat</h1>
      <div class="current-model" id="currentModelDisplay">...</div>
      <button id="newChat">
        <img src="icon/plus.png" alt="New Chat" style="width:28px;height:28px;">
        New Chat
      </button>
      <button id="changeModel">
        <img src="icon/model.png" alt="Change Model" style="width:28px;height:28px;">
        Change Model
      </button>
      <button id="openSettings">
        <img src="icon/settings.png" alt="Settings" style="width:28px;height:28px;">
        Settings
      </button>
    </div>
    <div id="sidebarModelInstallProgressContainer" style="display:none; margin-top: 15px; padding: 10px; background-color: var(--card-bg); border-radius: 8px; text-align: center;">
      <div id="sidebarProgressLabel" style="font-size: 0.9em; margin-bottom: 5px; color: var(--text-secondary);">Installing model...</div>
      <div class="progress-container" style="height: 10px; background-color: var(--main-bg);">
        <div id="sidebarProgressFill" class="progress-fill" style="width: 0%; height: 100%;"></div> 
      </div>
      <div id="sidebarProgressText" style="font-size: 0.8em; color: var(--text-secondary); margin-top: 3px;">0%</div>
    </div>
    <div class="chat-list" id="chatList"></div>
  </div>
  
  <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ -->
  <div class="toggle-sidebar" id="toggleSidebar">‚óÄ</div>
  
  <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
  <div class="main" id="mainContent">
    <div class="chat-window" id="chatWindow">
      <div class="drag-overlay" id="dragOverlay">
        <p>Drop files here</p>
      </div>
      <div class="chat-content" id="chatContent"></div>
    </div>
    <div class="input-wrapper">
      <div class="intro-text" id="introText">
        <p id="introTitle">Hi, I'm S/E Chat</p>
        <p id="introSubtitle">How can I help you todayüòä?</p>
      </div>
      <div id="attachmentsContainer"></div>
      <div class="input-area">
        <button id="imageUploadBtn" title="Attach file">
          <img src="icon/attach-file.png" alt="Attach file" style="width: 24px; height: 24px;">
        </button>
        <button id="toolsBtn" title="Toggle Tools">
          <img src="icon/tools.png" alt="Tools" style="width: 24px; height: 24px;">
        </button>
        <input type="file" id="fileInput" multiple style="display: none;">
        <textarea id="chatInput" placeholder="Enter message..."></textarea>
        <button id="sendBtn" class="send-btn">
          <img src="icon/send.png" alt="Send" style="width:50px;height:50px;">
        </button>
        <button id="stopBtn" style="display:none;">
          <img src="icon/stop.png" alt="Stop" style="width:50px;height:50px;">
        </button>
      </div>
    </div>
  </div>
  
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ -->
  <div id="modelModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModelModal" title="Close">&times;</span>
      <h2 id="modelModalTitle">Change Model</h2>
      <div id="modelOptionsContainer"></div>
      <div id="modelCustomContainer"></div>
    </div>
  </div>
  
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeSettingsModal" title="Close">&times;</span>
      <h2 id="settingsModalTitle">Settings</h2>
      <div>
        <label for="languageSelect" id="languageLabel">Language:</label>
        <select id="languageSelect">
          <option value="en">English</option>
          <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        </select>
      </div>
      <div style="margin-top:15px;">
        <label for="defaultModelSelect" id="defaultModelLabel">Default Model:</label>
        <select id="defaultModelSelect"></select>
      </div>

      <div style="margin-top:15px;">
        <label for="modelTemperatureInput" id="modelTemperatureLabel">Model Temperature:</label>
        <div style="display: flex; align-items: center; gap: 10px; width: 90%; margin-top: 8px;">
          <input type="range" id="modelTemperatureInput" min="0" max="2" step="0.05" style="flex-grow: 1; height: 20px;">
          <span id="modelTemperatureValueSpan" style="min-width: 30px; text-align: right;">0.8</span>
        </div>
      </div>
      
      <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã -->
      <div style="margin-top:20px;">
        <label id="themeLabel">Theme:</label>
        <div class="theme-options">
          <div class="theme-option theme-dark active" data-theme="dark">Dark</div>
          <div class="theme-option theme-light" data-theme="light">Light</div>
        </div>
      </div>
      
      <div style="margin-top:20px;">
        <label id="backgroundLabel">Background:</label>
        <div class="custom-theme-inputs">
          <input type="file" id="bgImageInput" accept="image/*" style="display:none;">
          <button id="uploadBgBtn">Upload Image</button>
          <button id="resetBgBtn">Reset</button>
        </div>
        
        <div class="bg-preview" id="bgPreview">
          <span id="bgPreviewText">No background</span>
        </div>
      </div>
      
      <div style="margin-top:20px;">
        <label>Custom Gradient:</label>
        <div class="custom-theme-inputs">
          <input type="color" id="gradientColor1" value="#4166d5">
          <input type="color" id="gradientColor2" value="#1e1f25">
        </div>
        <button id="applyGradientBtn" style="width:100%; margin-top:10px;">Apply Gradient</button>
      </div>
      
      
      <button id="saveSettingsBtn">Save Settings</button>
    </div>
  </div>
  
  <script src="js/highlightjs/highlight.min.js"></script>
  <script>
    // --- GLOBAL TRANSLATIONS ---
    const translations = {
      en: {
        headerTitle: "S/E Chat",
        currentModel: "Current Model: ",
        newChat: "New Chat",
        changeModel: "Change Model",
        settings: "Settings",
        send: "Send",
        stop: "Stop",
        languageLabel: "Language:",
        defaultModelLabel: "Default Model:",
        modelTemperatureLabel: "Model Temperature:",
        modelModalTitle: "Change Model",
        settingsModalTitle: "Settings",
        saveSettings: "Save Settings",
        deleteBtn: "Delete",
        inputPlaceholder: "Enter message...",
        copyBtn: "Copy",
        copiedBtn: "Copied!",
        attachFile: "Attach file",
        copyUserMessage: "Copy message",
        copyAssistantMessage: "Copy answer",
        dropFilesHere: "Drop files here",
        customModel: "Add Model",
        installModel: "Install Model",
        close: "Close",
        newChatTitle: "New Chat",
        introTitle: "Hi, I'm S/E Chat",
        introSubtitle: "How can I help you todayüòä?",
        themeLabel: "Theme:",
        backgroundLabel: "Background:",
        inputPlaceholderGeneratingTitle: "Generating chat title, please wait...",
      },
      ru: {
        headerTitle: "S/E –ß–∞—Ç",
        currentModel: "–¢–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å: ",
        newChat: "–ù–æ–≤—ã–π —á–∞—Ç",
        changeModel: "–°–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å",
        settings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
        send: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å",
        stop: "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å",
        languageLabel: "–Ø–∑—ã–∫:",
        defaultModelLabel: "–ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:",
        modelTemperatureLabel: "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏:",
        modelModalTitle: "–°–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å",
        settingsModalTitle: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
        saveSettings: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏",
        deleteBtn: "–£–¥–∞–ª–∏—Ç—å",
        inputPlaceholder: "–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...",
        copyBtn: "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å",
        copiedBtn: "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!",
        attachFile: "–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª",
        copyUserMessage: "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ",
        copyAssistantMessage: "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç",
        dropFilesHere: "–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞",
        customModel: "–î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å",
        installModel: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å",
        close: "–ó–∞–∫—Ä—ã—Ç—å",
        newChatTitle: "–ù–æ–≤—ã–π —á–∞—Ç",
        introTitle: "–ü—Ä–∏–≤–µ—Ç, —è S/E –ß–∞—Ç",
        introSubtitle: "–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—åüòä?",
        themeLabel: "–¢–µ–º–∞:",
        backgroundLabel: "–§–æ–Ω:",
        inputPlaceholderGeneratingTitle: "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ —á–∞—Ç–∞, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ...",
      }
    };

    // Initalize markdown-it with highlight.js integration
    const markdown = window.markdownit({
      html: false,
      linkify: true,
      typographer: true,
      breaks: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return '<pre><code class="hljs">' +
                   hljs.highlight(str, { language: lang, ignoreIllegals: true }).value +
                   '</code></pre>';
          } catch (__) {}
        }
        return '<pre><code class="hljs">' + markdown.utils.escapeHtml(str) + '</code></pre>';
      }
    });

    // Custom renderer for fenced code blocks to add the language and copy button
    markdown.renderer.rules.fence = function (tokens, idx) {
      const token = tokens[idx];
      const info = token.info ? markdown.utils.unescapeAll(token.info).trim() : '';
      let langName = '', langAttrs = '';
      if (info) {
        langName = info.split(/(\s+)/g)[0];
        langAttrs = info.slice(langName.length);
      }
      const highlighted = markdown.options.highlight(token.content, langName, langAttrs) || markdown.utils.escapeHtml(token.content);

      const lang = languageSelect ? languageSelect.value : 'en'; // Fallback to 'en'
      const copy = translations[lang] ? translations[lang].copyBtn : 'Copy';
      const copied = translations[lang] ? translations[lang].copiedBtn : 'Copied!';

      let result = `<div class="code-container">`;
      if (langName) {
        result += `<div class="code-language">${langName}</div>`;
      }
      result += `<button class="copy-btn" onclick="copyCode(this, '${copied}', '${copy}')">`;
      result += `<img src="icon/copy.png" alt="Copy" style="width:24px; height:24px; vertical-align: middle; margin-right: 4px;">`;
      result += `<span>${copy}</span>`;
      result += `</button>`;
      result += highlighted;
      result += `</div>`;
      return result;
    };

    markdown.toHTML = markdown.render;
  </script>
  <script src="js/main.js" type="module"></script>
</body>
</html>